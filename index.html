<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>뉴스 트레이딩 대시보드</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/variables.css?v=8">
    <link rel="stylesheet" href="css/base.css?v=8">
    <link rel="stylesheet" href="css/components.css?v=8">
    <link rel="stylesheet" href="css/dashboard.css?v=8">
</head>
<body>
    <!-- 헤더 -->
    <header class="header">
        <div class="header-left">
            <h1>🔮 뉴스 트레이딩 대시보드</h1>
            <div class="subtitle">매일 아침 08:30 자동 선정 | <a href="system_guide.html">📚 시스템 가이드</a></div>
        </div>
    </header>

    <!-- 대시보드 컨테이너 -->
    <div class="dashboard-container">

        <!-- 섹션 1: 기간 선택 -->
        <section class="period-section">
            <h2>📅 분석 기간</h2>
            <div class="period-controls">
                <div class="date-inputs">
                    <input type="date" id="startDate">
                    <span>~</span>
                    <input type="date" id="endDate">
                </div>
                <div class="quick-buttons">
                    <button onclick="Dashboard.setQuickPeriod('all')">전체</button>
                    <button onclick="Dashboard.setQuickPeriod('year')">올해</button>
                    <button onclick="Dashboard.setQuickPeriod('month')">이번달</button>
                    <button onclick="Dashboard.setQuickPeriod('30days')">30일</button>
                    <button onclick="Dashboard.setQuickPeriod('7days')">7일</button>
                </div>
            </div>
        </section>

        <!-- 섹션 2: 전체 성과 -->
        <section class="stats-section">
            <h2>📊 전체 성과</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">최종 자산</div>
                    <div class="stat-value" id="finalCapital">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">누적 수익률</div>
                    <div class="stat-value" id="totalReturn">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">총 거래 수</div>
                    <div class="stat-value" id="totalTrades">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">승률</div>
                    <div class="stat-value" id="winRate">-</div>
                </div>
            </div>
        </section>

        <!-- 섹션 3: 차트 -->
        <section class="charts-section">
            <div class="chart-row">
                <div class="chart-container">
                    <h3>📈 자본 증가 곡선</h3>
                    <canvas id="equityChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>🍩 결과 분포</h3>
                    <canvas id="resultChart"></canvas>
                </div>
            </div>
        </section>

        <!-- 섹션 4: 상세 분석 (접기/펼치기) -->
        <section class="analytics-section">
            <div class="section-header" onclick="this.parentElement.classList.toggle('collapsed')">
                <h2>📊 상세 분석</h2>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="section-content">

                <!-- 점수대별 성과 -->
                <div class="analysis-subsection">
                    <h3>점수대별 성과</h3>
                    <table class="analysis-table" id="scoreRangeTable"></table>
                </div>

                <!-- 일자별 성과 -->
                <div class="analysis-subsection">
                    <h3>일자별 성과</h3>
                    <table class="analysis-table" id="dailyTable"></table>
                </div>

                <!-- 요일별 패턴 -->
                <div class="analysis-subsection">
                    <h3>요일별 패턴</h3>
                    <canvas id="dayOfWeekChart"></canvas>
                    <table class="analysis-table" id="dayOfWeekTable"></table>
                </div>

                <!-- 선정사유별 성과 -->
                <div class="analysis-subsection">
                    <h3>선정사유별 성과</h3>
                    <table class="analysis-table" id="reasonTable"></table>
                </div>

                <!-- 시간대별 패턴 -->
                <div class="analysis-subsection">
                    <h3>시간대별 익절/손절 패턴</h3>
                    <canvas id="timeOfDayChart"></canvas>
                </div>

                <!-- 수익률 분포 -->
                <div class="analysis-subsection">
                    <h3>수익률 분포</h3>
                    <canvas id="returnDistChart"></canvas>
                </div>

            </div>
        </section>

        <!-- 섹션 5: 오늘의 종목 -->
        <section class="today-section">
            <h2>🌟 오늘의 종목 (상위 3개)</h2>
            <div class="today-cards" id="todayCards">
                <p style="text-align: center; color: var(--text-secondary);">로딩 중...</p>
            </div>
        </section>

        <!-- 섹션 6: 거래 내역 테이블 -->
        <section class="table-section">
            <div class="section-header">
                <h2>📋 전체 거래 내역</h2>
                <div class="table-controls">
                    <input type="text" id="searchInput" placeholder="종목명 또는 코드 검색">
                    <select id="resultFilter">
                        <option value="all">전체</option>
                        <option value="profit">익절만</option>
                        <option value="loss">손절만</option>
                        <option value="none">미달만</option>
                    </select>
                    <select id="reasonFilter">
                        <option value="all">모든 사유</option>
                    </select>
                    <button onclick="Dashboard.exportToCSV()">CSV 내보내기</button>
                </div>
            </div>
            <div class="table-wrapper">
                <table class="transaction-table">
                    <thead>
                        <tr>
                            <th onclick="TableUtils.sortBy('date')">날짜</th>
                            <th onclick="TableUtils.sortBy('name')">종목명</th>
                            <th onclick="TableUtils.sortBy('code')">종목코드</th>
                            <th onclick="TableUtils.sortBy('score')">총점</th>
                            <th>선정사유</th>
                            <th>매수가</th>
                            <th>매도가</th>
                            <th onclick="TableUtils.sortBy('return')">수익률</th>
                            <th onclick="TableUtils.sortBy('profit')">손익금액</th>
                            <th>결과</th>
                        </tr>
                    </thead>
                    <tbody id="transactionTableBody">
                        <tr>
                            <td colspan="10" style="text-align: center; padding: var(--space-xl); color: var(--text-secondary);">
                                데이터를 불러오는 중...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="pagination" id="tablePagination"></div>
        </section>

    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="js/config.js?v=8"></script>
    <script src="js/utils.js?v=8"></script>
    <script src="js/analytics.js?v=8"></script>
    <script src="js/charts.js?v=8"></script>
    <script src="js/table.js?v=8"></script>
    <script src="js/dashboard.js?v=8"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            Dashboard.init();
        });
    </script>
</body>
</html>
